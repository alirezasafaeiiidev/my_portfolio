# ID: P0-04
## Title
Local-first persistence: IndexedDB store + usage history model

## Context
- Conversion-focused toolbox needs “history” (what the user processed, outputs, preferences) without server storage.
- Reference patterns exist in `_ops/external/asdev-persiantoolbox/app/api/history/route.ts` and `components/features/history/*` (in that external repo).
- Current app already uses localStorage for drafts (`src/components/sections/infrastructure-lead-form.tsx`).

## Steps
1. Add an IndexedDB wrapper (no external service) for:
   - tool runs (tool id, timestamps, input metadata only; never store raw sensitive file bytes by default)
   - user preferences (defaults like quality level, units, last used settings)
2. Add a `History` UI page (e.g., `/dashboard` or `/history`) showing recent runs with clear “clear history” control.
3. Add per-tool integration points to record successful runs and errors.
4. Add privacy controls:
   - “Do not save history” toggle
   - “Clear all local data” action

## Acceptance criteria
- Running a tool records a history item that persists after reload and works offline.
- User can clear history and verify that IndexedDB stores are empty.
- No raw file contents are persisted unless explicitly opted-in.

## Dependencies
- `P0-03`

## Files to modify (best guess)
- Add `src/lib/local-store/indexeddb.ts`
- Add `src/lib/history/*`
- Add `src/app/(tools)/dashboard/page.tsx` (or `src/app/history/page.tsx`)
- Add per-tool hooks once tools are implemented (see `P0-08`, `P0-09`)

