# ID: P0-02
## Title
Make PWA/offline real (register SW + offline page + update flow)

## Context
- Current PWA assets exist: `public/manifest.json`, `public/sw.js`, and registration helpers in `src/lib/service-worker.ts`.
- But `src/components/service-worker/client-provider.tsx` is not referenced from `src/app/layout.tsx`, so the SW likely never registers.
- Current SW (`public/sw.js`) is minimal and references `/favicon.ico` which does not exist (repo uses `public/favicon.svg`).
- Reference implementation exists in `_ops/external/asdev-persiantoolbox/public/sw.js` and `_ops/external/asdev-persiantoolbox/app/offline/page.tsx`.

## Steps
1. Mount the SW provider globally (e.g., render `ServiceWorkerProvider` from `src/app/layout.tsx`).
2. Add an explicit offline fallback route (e.g., `src/app/offline/page.tsx`) with `noindex,nofollow`.
3. Upgrade `public/sw.js` to:
   - Pre-cache app shell routes and key static assets.
   - Use `cache-first` for static assets and `network-first` for navigations with `/offline` fallback.
   - Provide an update channel (`postMessage` events such as `SKIP_WAITING`).
4. Add lightweight client UX for update availability (banner/toast) that triggers `SKIP_WAITING` and reload.
5. Validate manifest correctness (lang `fa`, dir `rtl`, icons present).

## Acceptance criteria
- In production build, `navigator.serviceWorker.controller` becomes active after first load (or after reload) and `Application → Service Workers` shows `/sw.js` registered.
- With network disabled, navigating to a cached route works; navigating to a non-cached route shows `/offline`.
- Update flow: new SW install triggers user-visible “Update available” state and can activate without breaking the app.

## Dependencies
- `P0-03` if you want tool routes pre-cached for toolbox launch.

## Files to modify (best guess)
- `src/app/layout.tsx`
- `src/components/service-worker/client-provider.tsx`
- `src/lib/service-worker.ts`
- `public/sw.js`
- `public/manifest.json`
- Add `src/app/offline/page.tsx`

